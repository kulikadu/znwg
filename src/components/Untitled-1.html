<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Title</title>
    <script src="static/js/jquery.js"></script>
    <script type="text/javascript" src="static/js/bootstrap.min.js"></script>
    <link href="static/css/bootstrap.css" rel="stylesheet" type="text/css" media="screen" />
    <link rel="stylesheet" href="static/css/ol.css" />
    <script src="static/js/ol.js"></script>
    <script src="static/js/mapfg.js"></script>
  </head>
  <body>
    <style>
      #mapppp {
        width: 100%;
        height: 1000px;
        background-color: white;
        overflow-y: scroll;
      }
    </style>
    <div id="mapppp"></div>
    <script>
      const projection_str = 'EPSG:4326'
      const format = 'image/png'
      const layer_name = 'basemap:xian'
      const Authorization_s = 'Basic em53Zzp6bndnQDIwMjM='
      const url = 'http://10.110.173.206:8080/geoserver/basemap/wms'
      const bounds = [108.78571637271052, 24.63934396381616, 114.25618232715077, 30.12909470046884] //边界范围
      function loadwms(projection_str, url, layerName, format, Authorization_s, bounds, mapd) {
        var untiled = new ol.layer.Image({
          source: new ol.source.ImageWMS({
            url: url,
            params: {
              FORMAT: format,
              LAYERS: layerName
            },
            imageLoadFunction: function (tile, src) {
              const xhr = new XMLHttpRequest()
              xhr.responseType = 'blob'
              xhr.open('GET', src)
              xhr.setRequestHeader('Authorization', Authorization_s)
              xhr.onload = function () {
                const url = URL.createObjectURL(xhr.response)
                const img = tile.getImage()
                img.addEventListener('load', function () {
                  URL.revokeObjectURL(url)
                })
                img.src = url
              }
              xhr.send()
            }
          })
        })
        var tiled = new ol.layer.Tile({
          source: new ol.source.TileWMS({
            url: url,
            params: {
              LAYERS: layerName
            },
            serverType: 'geoserver',
            projection: projection_str,
            tileLoadFunction: function (tile, src) {
              const xhr = new XMLHttpRequest()
              xhr.responseType = 'blob'
              xhr.open('GET', src)
              xhr.setRequestHeader('Authorization', Authorization_s)
              xhr.onload = function () {
                const url = URL.createObjectURL(xhr.response)
                const img = tile.getImage()
                img.addEventListener('load', function () {
                  URL.revokeObjectURL(url)
                })
                img.src = url
              }
              xhr.send()
            }
          })
        })
        var map = new ol.Map({
          controls: ol.control.defaults({
            attributionOptions: {
              collapsible: false
            }
          }),
          target: mapd,
          layers: [untiled, tiled],
          view: new ol.View({
            projection: projection_str
          })
        })
        map.getView().fit(bounds, map.getSize())
      }
      loadwms(projection_str, url, layer_name, format, Authorization_s, bounds, 'mapppp')
    </script>
  </body>
</html>
